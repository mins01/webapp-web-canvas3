<!doctype html>
<html lang="ko" >
<head>
  <title>web canvas 3</title>
  <meta charset="utf-8">
  <meta http-equiv="Content-Script-Type" content="text/javascript">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <!-- <meta name="viewport" content="width=600px" /> -->
  
  <script src="/js/ForGoogle.js"></script>
  <!-- google analytics -->
  <script>if(window.ForGoogle){ ForGoogle.analytics() }else{ console.log("failure : ForGoogle.analytics()");}</script>
  
  
  <!-- 부트스트랩 아이콘 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  
  <!-- jquery 관련 -->
  <!-- <script src="https://code.jquery.com/jquery-3.7.1.slim.min.js" integrity="sha256-kmHvs0B+OpCW5GVHUNjv9rOmY0IvSIRcf7zGUDTDQM8=" crossorigin="anonymous"></script> -->
  
  <!-- 부트스트랩 5.3.left -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
  <!-- // 부트스트랩 5.3.left -->
  
  <!-- 부트스트랩 커스텀용 -->
  <link rel="stylesheet" href="asset/bootstrap-custom.css">
  <!-- // 부트스트랩 커스텀용 -->
  
  
  
  
  
  
  
  <!-- vue.js -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->
  
  <link rel="shortcut icon" href="asset/favicon/favicon.ico">
  <link rel="apple-touch-icon" sizes="57x57" href="asset/favicon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="asset/favicon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="asset/favicon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="asset/favicon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="asset/favicon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="asset/favicon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="asset/favicon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="asset/favicon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="asset/favicon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="asset/favicon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="asset/favicon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="asset/favicon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="asset/favicon/favicon-16x16.png">
  <link rel="manifest" href="manifest.json">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
  
  <!-- meta og -->
  
  <meta property="og:title" content="web canvas 3">
  
  <meta property="og:description" content="web canvas 3">
  <meta name="og:image" content="http://www.mins01.com/img/logo.gif">
  <meta property="og:image:width" content="190">
  <meta property="og:image:height" content="70" />
  <meta property="og:site_name" content="web canvas 3" />
  <meta property="og:type" content="website">
  
  <!-- //meta og -->
  <!-- hammer.js -->
  <!-- <script src="https://cdnjs.com/libraries/hammer.js/"></script> -->
  
  <!-- //hammer.js -->
  
  <!--  Custom Elements Polyfill. 사용자 정의 요소 폴리필. 사파리에서 is 애드리뷰트 동작안해서 -->
  <!-- https://github.com/ungap/custom-elements -->
  <script src="//unpkg.com/@ungap/custom-elements/es.js"></script>

  <!-- WG2 uploader -->
  
  <script src="/WG2/js/Wg2Uploder.js"></script>
  <!-- <script src="http://mins01.com/WG2/js/Wg2Uploder.js"></script> -->
  <script>
    if(Wg2Uploder){
      globalThis.Wg2Uploder = Wg2Uploder;
    }
  </script>
  <!-- //WG2 uploader -->
  
  <!-- dayjs -->
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <!-- <script>dayjs().format()</script> -->
  <!-- //dayjs -->
  
  <!-- color palette -->
  <link rel="stylesheet" href="third_party/ui_ColorPalette/InputRangeBox/InputRangeBox.css">
  <script src="third_party/ui_ColorPalette/InputRangeBox/InputRangeBox.js"></script>
  
  <script src="third_party/ui_ColorPalette/toDraggable/toDraggable.js"></script>
  <link rel="stylesheet" href="third_party/ui_ColorPalette/ColorPalette.css">
  <script src="third_party/ui_ColorPalette/ColorPalette.js"></script>
  
  <style>
    .colorPalette-tab-hsl {
      max-height: 300px;
    }
  </style>
  <script>
    window.addEventListener('load',(evnet)=>{
      const foreColor = localStorage.getItem('foreColor')??'#000000';
      const bookmark = ["#000000","#ffffff","#c00000","#ff0000","#ffc000","#ffff00","#92d050","#00b050","#00b0f0","#0070c0","#002060","#7030a0"]
      
      const cpForeColor = globalThis.cpForeColor = ColorPalette({defColor:foreColor,bookmark:bookmark,maxHistory:40,localStorageHistoryKey:"cpForeColor"});
      InputRangeBox.autoInit(cpForeColor);
      
      document.getElementById('box-color-palette').appendChild(cpForeColor);
      cpForeColor.addEventListener('input',function(evt){
        // const targetColor = event?.target?.closest('.modal')?.dataset?.targetColor??'foreColor';
        
        // if(targetColor=='foreColor'){
        //     const obj = {'foreColor':this.toString()}
        //     editor.setContextConfig(obj);
        // }
      })
      cpForeColor.addEventListener('change',function(evt){
        // const modal = bootstrap.Modal.getOrCreateInstance(document.querySelector('#modal-color-palette'))
        // modal.hide();
      })
      cpForeColor.addEventListener('confirm',function(evt){
        const modal = bootstrap.Modal.getOrCreateInstance(document.querySelector('#modal-color-palette'))
        modal.hide();
        const wcTargetColor = event?.target?.closest('.modal')?.dataset?.wcTargetColor??'foreColor';
        if(wcTargetColor=='foreColor'){
          const obj = {'foreColor':this.toString()}
          editor.setContextConfig(obj);
          localStorage.setItem('foreColor',this.toString())
        }else if(wcTargetColor=='textColor'){
          const obj = {'textColor':this.toString()}
          editor.setTextConfig(obj);
        }
      })
      cpForeColor.addEventListener('cancel',function(evt){
        const modal = bootstrap.Modal.getOrCreateInstance(document.querySelector('#modal-color-palette'))
        modal.hide();
      })
      cpForeColor.addEventListener('setselectedcolor',function(evt){
        // console.log(evt.type,this.getSelectedColor())
      })
      
      
      document.querySelector('#modal-color-palette').addEventListener('show.bs.modal', event => {
        const wcTargetColor = event.target.dataset.wcTargetColor = event?.relatedTarget?.dataset.wcTargetColor??'foreColor';
        if(wcTargetColor=='foreColor'){
          cpForeColor.setPreview(editor.contextConfig.foreColor??'#000000')
        }else if(wcTargetColor=='textColor'){
          cpForeColor.setPreview(editor?.document?.layer?.textConfig?.textColor??'#000000')
        }
      })
    })
    window.addEventListener('beforeunload', function (e) {
      if(!editor.document || editor.document.history.length < 2){
        return
      }
      // 경고 메시지 설정
      const message = '변경사항이 저장되지 않을 수 있습니다. 정말 나가시겠습니까?';
      
      // 대부분의 브라우저에서는 e.returnValue를 설정해야 경고가 뜹니다.
      e.preventDefault(); // 일부 브라우저에서 필요
      e.returnValue = message;

      return message; // 일부 브라우저에서 필요
    });
  </script>
  <!-- //color palette -->
  <!-- ui-transform-tool -->
  <link rel="stylesheet" href="./third_party/ui-transform-tool/asset/ui-transform-tool.css">
  <script src="./third_party/ui-transform-tool/lib/UiTransformToolElement.js"></script>
  <script>
    // UiTransformToolElement.cssHtml = `<link rel="stylesheet" href="./asset/ui-transform-tool-shadowdom.css">`; // 올바른 경로로 변경!! 필수
    UiTransformToolElement.defineCustomElements();
  </script>
  <link rel="stylesheet" href="asset/utt-custom.css">
  <!-- //ui-transform-tool -->
  
  
  
  
  <link rel="stylesheet" href="asset/style.css">
  
  
  <link rel="stylesheet" href="third_party/ui-input-stepper/ui-input-stepper.css">
  <script src="third_party/ui-input-stepper/UiInputStepper.js"></script>
  <script>
    UiInputStepper.addEventListener();
    window.addEventListener('load',(event)=>{
      UiInputStepper.initDataValue()
    })
  </script>
  
  <style>
    /* canvas{
      outline: 1px dashed #aabbcc99;
    } */
  </style>
  <script src="asset/WcHelper.js"></script>
  <script>
    window.addEventListener('paste',WcHelper.onpaste)
    window.addEventListener('resize',WcHelper.onresize)
  </script>
  <script type="module" src="wc/app.js"></script>
  <script>
    globalThis.addEventListener('load',(event)=>{
      const wcApp = globalThis.wcApp = document.querySelector('#wc-app')
      wcApp.header = wcApp.querySelector('.wc-app-header')
      wcApp.body = wcApp.querySelector('.wc-app-body')
      wcApp.footer = wcApp.querySelector('.wc-app-footer')
      
      // document.querySelector('.checkbox-tool[value="Brush"]').click(); // 최초 선택 툴
    })
    window.addEventListener('wc.tools.load',event=>{ console.log(event.type,event.detail); })
    window.addEventListener('wc.tools.select',event=>{ console.log(event.type,event.detail); })
    window.addEventListener('wc.tool.activate',event=>{
      console.log(event.type,event.detail);
      wcApp.dataset.tool = event.detail.toolName;
      wcApp.dataset.toolEnable = event.detail.tool.enable;
    })
    window.addEventListener('wc.tool.inactivate',event=>{ console.log(event.type,event.detail); })
    window.addEventListener('wc.tool.confirm',event=>{ console.log(event.type,event.detail); })
    window.addEventListener('wc.tool.cancel',event=>{ console.log(event.type,event.detail); })
    window.addEventListener('wc.document.layers.select',event=>{ console.log(event.type,event.detail); })
    
  </script>
</head>
<body>
  <div id="wc-app" class="wc-app debug-box" data-tool="" data-tool-enable="false">
    <div class="wc-app-wrap">
      <div class="wc-app-header">
        <div class="wc-app-nav d-flex gap-1 px-1 py-1 justify-content-center mx-auto">
          <button type="button" class="btn btn-lg btn-outline-light" data-bs-toggle="modal" data-bs-target="#modal-menu-main"><i class="bi bi-menu-app"></i></button>
          <div onclick="wcApp.classList.toggle('show-wc-app-menu-tools'); this.blur();">
            <div class="only-shown only-shown-tool-Brush"><button type="button" class="btn btn-lg btn-outline-light" ><i class="bi bi-brush"></i></button></div>
            <!-- <div class="only-shown only-shown-tool-Brush1 position-relative"><button type="button" class="btn btn-lg btn-outline-light" ><i class="bi bi-brush"></i><small class="position-absolute bottom-0" style="right:0.5em">1</small></button></div> -->
            <div class="only-shown only-shown-tool-Brush2 position-relative"><button type="button" class="btn btn-lg btn-outline-light" ><i class="bi bi-brush"></i><small class="position-absolute bottom-0" style="right:0.5em">2</small></button></div>
            <div class="only-shown only-shown-tool-Brush3 position-relative"><button type="button" class="btn btn-lg btn-outline-light" ><i class="bi bi-brush"></i><small class="position-absolute bottom-0" style="right:0.5em">3</small></button></div>
            <div class="only-shown only-shown-tool-Eraser"><button type="button" class="btn btn-lg btn-outline-light" ><i class="bi bi-eraser"></i></button></div>
            <div class="only-shown only-shown-tool-Text"><button type="button" class="btn btn-lg btn-outline-light" ><i class="bi bi-alphabet-uppercase"></i></button></div>
            <div class="only-shown only-shown-tool-Spuit"><button type="button" class="btn btn-lg btn-outline-light" ><i class="bi bi-eyedropper"></i></button></div>
            <div class="only-shown only-shown-tool-Transform"><button type="button" class="btn btn-lg btn-outline-light" ><i class="bi bi-bounding-box"></i></button></div>
            <div class="only-shown only-shown-tool-Move"><button type="button" class="btn btn-lg btn-outline-light" ><i class="bi bi-arrows-move"></i></button></div>
            <div class="only-shown only-shown-tool-Hand"><button type="button" class="btn btn-lg btn-outline-light" ><i class="bi bi-hand-index"></i></button></div>
          </div>
          <div class="group-only-enable-tool-enable">
            <button type="button" class="btn btn-lg btn-outline-success only-shown only-shown-tool-Brush" data-bs-toggle="modal" data-bs-target="#modal-brush-config"><i class="bi bi-sliders"></i></button>
            <!-- <button type="button" class="btn btn-lg btn-outline-success only-shown only-shown-tool-Brush1" data-bs-toggle="modal" data-bs-target="#modal-brush1-config"><i class="bi bi-sliders"></i></button> -->
            <button type="button" class="btn btn-lg btn-outline-success only-shown only-shown-tool-Brush2" data-bs-toggle="modal" data-bs-target="#modal-brush2-config"><i class="bi bi-sliders"></i></button>
            <button type="button" class="btn btn-lg btn-outline-success only-shown only-shown-tool-Brush3" data-bs-toggle="modal" data-bs-target="#modal-brush3-config"><i class="bi bi-sliders"></i></button>
            
            <button type="button" class="btn btn-lg btn-outline-success only-shown only-shown-tool-Eraser" data-bs-toggle="modal" data-bs-target="#modal-eraser-config"><i class="bi bi-sliders"></i></button>
            
            <button type="button" class="btn btn-lg btn-outline-success only-shown only-shown-tool-Text"  data-bs-toggle="modal" data-bs-target="#modal-text-config"><i class="bi bi-sliders"></i></i></button>
            
            <button type="button" class="btn btn-lg btn-outline-success only-shown only-shown-tool-Spuit" disabled><i class="bi bi-sliders"></i></i></button>
            
            
            
            <button type="button" class="btn btn-lg btn-outline-success only-shown only-shown-tool-Transform"  data-bs-toggle="modal" data-bs-target="#modal-transform-config"><i class="bi bi-sliders"></i></button>
            <button type="button" class="btn btn-lg btn-outline-success only-shown only-shown-tool-Move" x-data-bs-toggle="modal" x-data-bs-target="#modal-layer-config" onclick="editor.showModalLayerProperty(editor.document.layer)"><i class="bi bi-sliders"></i></button>
            <button type="button" class="btn btn-lg btn-outline-success only-shown only-shown-tool-Hand" data-bs-toggle="modal" data-bs-target="#modal-document-config"><i class="bi bi-sliders"></i></button>
            
          </div>
          <div class="only-hidden-tool-Text">
            <button type="button" class="btn btn-lg btn-outline-light wc-bg-foreColor" data-wc-target-color="foreColor" data-bs-toggle="modal" data-bs-target="#modal-color-palette" id="btn-palette" style="text-shadow: 1px 0px 1px black;"><i class="bi bi-palette" style="color: #fff;"></i></button>
          </div>
          <div class="only-shown only-shown-tool-Text">
            <button type="button" class="btn btn-lg btn-outline-light wc-bg-textColor position-relative" data-wc-target-color="textColor" data-bs-toggle="modal" data-bs-target="#modal-color-palette" id="btn-palette-textColor" style="text-shadow: 1px 0px 1px black;"><i class="bi bi-palette" style="color: #fff;"></i><div class="position-absolute bottom-0" style="left:0;right:0;"><i class="bi bi-alphabet-uppercase" style="color: #fff;"></i></div></button>
          </div>
          <button type="button" class="btn btn-lg btn-outline-light" data-bs-toggle="modal" data-bs-target="#modal-layers"><i class="bi bi-layers"></i></button>
          <button type="button" class="btn btn-lg btn-outline-light" data-bs-toggle="modal" data-bs-target="#modal-menu-setting"><i class="bi bi-gear"></i></button>
        </div>
        <div class="px-1">
          <div class="wc-app-menu wc-app-menu-tools" >
            <div class="wc-app-menu-content  gap-1 px-1 py-1 x-d-flex flex-wrap x-justify-content-between mx-auto border border-1 mt-1 " onclick="wcApp.classList.remove('show-wc-app-menu-tools');">
              <!-- <label role="button" title="tool Line" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Line" onclick="editor.tools.select(this.value);" checked><button type="button" class="btn btn-md btn-outline-success pe-none" ><i class="bi bi-slash-lg"></i></button></label>
              <label role="button" title="tool Pen" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Pen" onclick="editor.tools.select('Pen')"><button type="button" class="btn btn-md btn-outline-success pe-none"><i class="bi bi-pen"></i></button></label> -->
              <label role="button" title="tool Brush" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Brush" onclick="editor.tools.select(this.value);"><button type="button" class="btn btn-md btn-outline-success pe-none"><i class="bi bi-brush"></i></button></label>
              <!-- <label role="button" title="tool Brush1" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Brush1" onclick="editor.tools.select(this.value);"><button type="button" class="btn btn-md btn-outline-success pe-none position-relative"><i class="bi bi-brush"></i><small class="position-absolute bottom-0" style="right:0.5em">1</small></button></label> -->
              <label role="button" title="tool Brush2" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Brush2" onclick="editor.tools.select(this.value);"><button type="button" class="btn btn-md btn-outline-success pe-none position-relative"><i class="bi bi-brush"></i><small class="position-absolute bottom-0" style="right:0.5em">2</small></button></label>
              <label role="button" title="tool Brush3" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Brush3" onclick="editor.tools.select(this.value);"><button type="button" class="btn btn-md btn-outline-success pe-none position-relative"><i class="bi bi-brush"></i><small class="position-absolute bottom-0" style="right:0.5em">3</small></button></label>
              
              <label role="button" title="tool Eraser" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Eraser" onclick="editor.tools.select(this.value);"><button type="button" class="btn btn-md btn-outline-success pe-none"><i class="bi bi-eraser"></i></button></label>
              
              <label role="button" title="tool Text" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Text" onclick="editor.tools.select(this.value);"><button type="button" class="btn btn-md btn-outline-success pe-none"><i class="bi bi-alphabet-uppercase"></i></button></label>
              
              <label role="button" title="tool Spuit" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Spuit" onclick="editor.tools.select(this.value);"><button type="button" class="btn btn-md btn-outline-success pe-none"><i class="bi bi-eyedropper"></i></button></label>
              
              
              
              <label role="button" title="tool Transform" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Transform" onclick="editor.tools.select(this.value);"><button type="button" class="btn btn-md btn-outline-success pe-none"><i class="bi bi-bounding-box"></i></button></label>
              <label role="button" title="tool Move" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Move" onclick="editor.tools.select(this.value);"><button type="button" class="btn btn-md btn-outline-success pe-none"><i class="bi bi-arrows-move"></i></button></label>
              <label role="button" title="tool Hand" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Hand" onclick="editor.tools.select(this.value);"><button type="button" class="btn btn-md btn-outline-success pe-none"><i class="bi bi-hand-index"></i></button></label>
              
              <!-- <label role="button" title="tool Rectangle" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Rectangle" onclick="editor.tools.select(this.value);"><button type="button" class="btn btn-md btn-outline-success pe-none"><i class="bi bi-square"></i></button></label> -->
              <!-- <label role="button" title="tool Circle" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Circle" onclick="editor.tools.select(this.value);"><button type="button" class="btn btn-md btn-outline-success pe-none"><i class="bi bi-circle"></i></button></label> -->
              <!-- <label role="button" title="tool Text" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  value="Text" onclick="editor.tools.select(this.value);"><button type="button" class="btn btn-md btn-outline-success pe-none"><i class="bi bi-body-text"></i></button></label> -->
              <!-- <label role="button" title="tool Text commit" ><input hidden class="btn-check position-absolute checkbox-tool" type="radio" name="tool"  onclick="editor.tool.commit()"><button type="button" class="btn btn-md btn-outline-success pe-none" ><i class="bi bi-body-text"></i><i class="bi bi-bandaid"></i></button></label> -->
            </div>
          </div>
        </div>
        
      </div>
      
      <div class="wc-app-footer">
        <div class="container px-0 d-flex justify-content-between">
          <div class="wc-app-menu wc-app-menu-undo  d-flex gap-1 px-1 py-1 justify-content-center mx-auto ms-0">
            <button type="button" class="btn btn-md btn-warning" onclick="editor?.document.history.undo()"><i class="bi bi-arrow-counterclockwise"></i></button>
            <button type="button" class="btn btn-md btn-warning" onclick="editor?.document.history.redo()"><i class="bi bi-arrow-clockwise"></i></button>
            <!-- <button type="button" class="btn btn-md btn-outline-warning" onclick="editor?.document.history.save('manual')"><i class="bi bi-save2"></i></button> -->
          </div>
          <div class="wc-app-menu wc-app-menu-tool-propety  d-flex gap-1 px-1 py-1 justify-content-center mx-auto me-0">
            <!-- 오른쪽하단 버튼 위치 -->
          </div>
        </div>
        <div class="container px-0 d-flex justify-content-center">
          <div class="only-shown only-shown-tool-Transform my-1">
            <div class="d-flex flex-wrap justify-content-center gap-3">
              <div>
                <div class="form-label mb-0"><i class="bi bi-info-circle"></i> Action</div>
                <div class="d-flex gap-1">
                  <button class="btn btn-primary" onclick="editor.tool.confirm();"><i class="bi bi-check"></i> Confirm</button>
                  <button class="btn btn-warning" onclick="editor.tool.cancel();"><i class="bi bi-x"></i> Cancel</button>
                </div>
              </div>
              <div>
                <div class="form-label mb-0"><i class="bi bi-arrows-move"></i> Postion</div>
                <div class="d-flex gap-1">
                  <button class="btn btn-primary" onclick="editor.tool.center();">Center</button>
                </div>
              </div>
              <div>
                <div class="form-label mb-0"><i class="bi bi-bounding-box"></i> Resize</div>
                <div class="d-flex gap-1">
                  <button class="btn btn-primary" onclick="if(editor?.document?.layer){ let layer = editor?.document?.layer; layer.adjustSize(layer.parent.width,layer.parent.height);layer.flush();editor.saveHistory();editor.tool.activate();}">Fit Document</button>
                </div>
              </div>
              
            </div>
          </div>
          <div class="only-shown only-shown-tool-Text my-1">
            <div class="d-flex flex-wrap justify-content-center gap-3">
              <div>
                <div class="form-label mb-0"><i class="bi bi-info-circle"></i> Action</div>
                <div class="d-flex gap-1">
                  <button class="btn btn-primary" onclick="editor.tool.confirm();"><i class="bi bi-check"></i> Confirm</button>
                  <button class="btn btn-warning" onclick="editor.tool.cancel();"><i class="bi bi-x"></i> Cancel</button>
                </div>
              </div>              
            </div>
          </div>
        </div>
      </div>
      <div id="wc-editor" class="wc-editor wc-app-body debug-box">
        <!-- <div class="wc-frame">
          <canvas id="wc-document" class="wc-document" width="300" height="300" is="wc-document"></canvas>
        </div> -->
        <ui-transform-tool id="utt01" class="custom-01 only-shown only-shown-tool-Transform only-shown-tool-Text only-display-tool-enable" resizable moveable integeronly  width="100" height="100" left="10" top="10" >
          <div class="only-shown only-shown-tool-Transform">
            <div class="text-center">
              TRANSFORM<br>
              <i class="bi bi-bounding-box"></i>
            </div>
          </div>
          <div class="only-shown only-shown-tool-Text">
            <div class="text-center">
              TEXT<br>
              <i class="bi bi-alphabet-uppercase"></i>
            </div>
          </div>
        </ui-transform-tool>
        <script>
          {
            const utt01 = document.querySelector('#utt01');
            utt01.addEventListener('pointerdown',(event)=>{
              event.stopPropagation();
              event.preventDefault();
            })
            
            utt01.addEventListener('utt-move',(event)=>{
              const utt = event.target
              event.stopPropagation();
              event.preventDefault();
              editor?.tool?.onuttmove()
            })
            utt01.addEventListener('utt-resize',(event)=>{
              const utt = event.target
              event.stopPropagation();
              event.preventDefault();
              editor?.tool?.onuttresize()
            })
            
            utt01.addEventListener('utt-move-end',(event)=>{
              const utt = event.target
              event.stopPropagation();
              event.preventDefault();
              editor?.tool?.onuttmoveend()
            })
            utt01.addEventListener('utt-resize-end',(event)=>{
              const utt = event.target
              event.stopPropagation();
              event.preventDefault();
              editor?.tool?.onuttresizeend()
            })
            
            
          }
        </script>
      </div>
      
    </div>
    <!-- <div class="wc-app-preview-layers">
      <div id="div-for-debug" class="preview-layers">
        
      </div>
      <div>
        <button type="button" class="btn btn-primary" onclick="if(editor?.document?.layer){ editor.document.layer.visible = true; editor.document.layer.flush() }">visible:on</button>
        <button type="button" class="btn btn-primary" onclick="if(editor?.document?.layer){ editor.document.layer.visible = false; editor.document.layer.flush() }">visible:off</button>
      </div>
    </div> -->
  </div>
  
  <!-- Modal -->
  <div class="modals">
    
    <div class="modal fade" id="modal-menu-main"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4">Webapp WC3</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body border-bottom">
            <h5>File</h5>
            <div class="row g-1">
              <div class="col-6">
                <button type="button" class="w-100 btn btn-lg btn-primary" data-bs-toggle="modal" data-bs-target="#modal-file-new">
                  <div class="fs-4"><i class="bi bi-file-earmark-plus"></i></div>
                  <div>NEW</div>
                </button>
              </div>
              <div class="col-6">
                <button type="button" class="w-100 btn btn-lg btn-primary" data-bs-toggle="modal" data-bs-target="#modal-file-open">
                  <div class="fs-4"><i class="bi bi-folder2-open"></i></div>
                  <div>OPEN</div>
                </button>
              </div>
              <div class="col-6">
                <button type="button" class="w-100 btn btn-lg btn-primary" data-bs-toggle="modal" data-bs-target="#modal-file-download">
                  <div class="fs-4"><i class="bi bi-file-earmark-arrow-down"></i></div>
                  <div>DOWNLOAD</div>
                </button>
              </div>
              <div class="col-6">
                <button type="button" class="w-100 btn btn-lg btn-primary" data-bs-toggle="modal" data-bs-target="#modal-file-upload">
                  <div class="fs-4"><i class="bi bi-cloud-upload"></i></div>
                  <div>UPLOAD</div>
                </button>
              </div>
              <div class="col-6">
                <button type="button" class="w-100 btn btn-lg btn-primary" onclick="editor.previewDocument()">
                  <div class="fs-4"><i class="bi bi-image"></i></div>
                  <div>PREVIEW</div>
                </button>
              </div>
              <div class="col-6">
                <button type="button" class="w-100 btn btn-lg btn-primary" onclick="editor.closeDocument()">
                  <div class="fs-4"><i class="bi bi-x-circle"></i></div>
                  <div>CLOSE</div>
                </button>
              </div>
            </div>
            <hr>
            <h5>Etc</h5>
            <div class="row g-1">
              <div class="col-6">
                <button type="button" class="w-100 btn btn-lg btn-primary" data-bs-toggle="modal" data-bs-target="#modal-autosave">
                  <div class="fs-4"><i class="bi bi-robot"></i></div>
                  <div>Auto Save</div>
                </button>
              </div>
              <div class="col-6">
                <button type="button" class="w-100 btn btn-lg btn-warning" onclick="WcHelper.newForTest(editor)">
                  <div class="fs-4"><i class="bi bi-emoji-smile-upside-down"></i></div>
                  <div>For Test</div>
                </button>
              </div>
              <div class="col-6">
                <button type="button" class="w-100 btn btn-lg btn-warning" onclick="WcHelper.newForTest2(editor)">
                  <div class="fs-4"><i class="bi bi-emoji-smile-upside-down"></i></div>
                  <div>For Test2</div>
                </button>
              </div>
            </div>
            
          </div>
          <div class="modal-body">
            <div class="d-flex flex-column gap-3">
              <form action="" onsubmit="return false" onchange="editor.setEditorConfig(Wc.HtmlUtil.formToObject(this))" data-wc-sync-form="editor.editorConfig">
                <h5>Input mode</h5>
                <div class="row g-1">
                  <label class="col-3" role="button"><input class="btn-check" type="radio" name="inputMode" value="all" checked ><button class="w-100 btn btn-outline-primary pe-none"><i class="bi bi-asterisk"></i><br> ALL</button></label>
                  <label class="col-3" role="button"><input class="btn-check" type="radio" name="inputMode" value="pen" ><button class="w-100 btn btn-outline-primary pe-none"><i class="bi bi-pencil-square"></i><br> pen</button></label>
                  <label class="col-3" role="button"><input class="btn-check" type="radio" name="inputMode" value="touch" ><button class="w-100 btn btn-outline-primary pe-none"><i class="bi bi-hand-index"></i><br> touch</button></label>
                  <label class="col-3" role="button"><input class="btn-check" type="radio" name="inputMode" value="mouse" ><button class="w-100 btn btn-outline-primary pe-none"><i class="bi bi-mouse2"></i><br> mouse</button></label>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
        
    <div class="modal fade" id="modal-menu-setting"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-gear"></i> Setting</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="d-flex gap-3">
              <button type="button" class="w-100 btn btn-md btn-primary" data-bs-toggle="modal" data-bs-target="#modal-document-config">
                <i class="bi bi-file-earmark-image"></i> Document
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
        
    <div class="modal fade" id="modal-file-open"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-folder2-open"></i> OPEN FILE</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div>
              <div class="form-label m-0"><i class="bi bi-pc-display"></i>/<i class="bi bi-phone"></i> From device</div>
              <form action="" onsubmit="if(this.openfile.files.length){ editor.loadDocument(this.openfile.files[0]).then((r)=>{console.log('loadDocument 완료'); }); this.reset() }else{ alert('Select a file(*.wc3.json | image file )')}; return false;" >
                <div class="input-group input-group-lg">
                  <input type="file" class="form-control" name="openfile" accept=".wc3.json,image/*">
                </div>
                <div class="form-text text-end"><i class="bi bi-info-circle"></i> image 파일과 .wc3.json 파일이 지원됩니다.</div>
                <div class="text-end my-1">
                  <button type="submit" class="btn btn-primary" ><i class="bi bi-file-earmark-arrow-up"></i> OPEN</button>
                </div>
              </form>
            </div>
            <div>
              <div class="form-label m-0"><i class="bi bi-cloud"></i> From URL</div>
              <form action="" onsubmit="if(this.openfile.value.length){ editor.loadDocument(this.openfile.value).then((r)=>{console.log('loadDocument 완료'); }); this.reset() }else{ alert('Select a file(*.wc3.json | image URL )')}; return false;" >
                <div class="input-group input-group-lg">
                  <input type="text" class="form-control" name="openfile" placeholder="https://-- or /--">
                </div>
                <div class="form-text text-end"><i class="bi bi-info-circle"></i> image 파일과 .wc3.json 파일이 지원됩니다.</div>
                <div class="form-text text-end"><i class="bi bi-info-circle"></i> 같은 도메인의 URL만 지원합니다.</div>
                <div class="text-end my-1">
                  <button type="submit" class="btn btn-primary" ><i class="bi bi-file-earmark-arrow-up"></i> OPEN</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
        
    <div class="modal fade" id="modal-file-preview"  aria-hidden="true">
      <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-image"></i> PREVIEW</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body pb-0" style="flex:0 0 auto">
            <div class="text-center form-text mb-1">
              <div class="fs-4" id="img-preview-natural-size"></div>
              <div class="fs-6" id="img-preview-size"></div>
            </div>
          </div>
          <div class="modal-body">
            <div><img id="img-preview" class="my-3 shadow" src="" alt="image preview"></div>
          </div>
        </div>
      </div>
    </div>
        
    <div class="modal fade" id="modal-file-download"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-file-earmark-arrow-down"></i> Download</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="d-flex flex-column gap-3 p-1">
              <form action="" onsubmit="editor.downloadDocument(this.type.value,this.filename.value,this.quality.value);return false;">
                <input type="hidden" name="type" value="png">
                <div class="d-flex flex-column gap-3">
                  <div class="input-group ">
                    <span class="input-group-text">file name</span>
                    <input type="text" class="form-control filename"  name="filename" value="" required  data-wc-sync-from="editor.document.name">
                  </div>
                  <div class="input-group">
                    <span class="input-group-text">quality</span>
                    <select class="form-select" name="quality">
                      <option value="1">100</option>
                      <option value="0.9">90</option>
                      <option selected value="0.8">80</option>
                      <option value="0.7">70</option>
                      <option value="0.6">60</option>
                      <option value="0.5">50</option>
                      <option value="0.4">40</option>
                      <option value="0.3">30</option>
                      <option value="0.2">20</option>
                      <option value="0.1">10</option>
                      <option value="0">0</option>
                    </select>
                  </div>
                  <div class="d-grid gap-3 " style="grid-template-columns: repeat(2 , 1fr);;">
                    <div>
                      <button type="submit" class="w-100 btn btn-lg btn-primary" onclick="this.form.type.value='png';"> <i class="bi bi-filetype-png"></i> Download .png</button>
                      <div class="form-text mt-0 mb-0"><i class="bi bi-info-circle"></i> quality를 적용할 수 없습니다.</div>
                    </div>
                    <div>
                      <button type="submit" class="w-100 btn btn-lg btn-primary" onclick="this.form.type.value='jpg';"> <i class="bi bi-filetype-jpg"></i> Download .jpg</button>
                      <div class="form-text mt-0 mb-0"><i class="bi bi-info-circle"></i> 손실 압축.</div>
                    </div>
                    <div>
                      <button type="submit" class="w-100 btn btn-lg btn-primary" onclick="this.form.type.value='webp';"> <i class="bi bi-image"></i> Download .webp</button>
                      <div class="form-text mt-0 mb-0"><i class="bi bi-info-circle"></i> 손실 압축. 브라우저 지원 확인 필요</div>
                    </div>
                    <div>
                      <button type="submit" class="w-100 btn btn-lg btn-primary" onclick="this.form.type.value='wc3.json';"> <i class="bi bi-filetype-json"></i> Download .wc3.json</button>
                      <div class="form-text mt-0 mb-0"><i class="bi bi-info-circle"></i> 레이어 정보가 같이 저장됩니다.</div>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
        
    <div class="modal fade" id="modal-file-upload"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-file-earmark-arrow-down"></i> UPLOAD</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="d-flex flex-column gap-3 p-1">
              
              <form action="" onsubmit="editor.uploadDocument('png',this.filename.value).then(()=>{ console.log('uploadDocument 완료'); }).catch((e)=>{console.error('uploadDocument 실패',e); alert(e.message); });return false;">
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-filetype-png"></i></span>
                  <input type="text" class="form-control filename"  name="filename" value="" required>
                  <span class="input-group-text">.png</span>
                  <button type="submit" class="btn btn-lg btn-primary"> UPLOAD </button>
                </div>
              </form>
              <form action="" onsubmit="editor.uploadDocument('wc3.json',this.filename.value).then(()=>{ console.log('uploadDocument 완료'); }).catch((e)=>{console.error('uploadDocument 실패',e); alert(e.message); });return false;">
                <div class="input-group">
                  <span class="input-group-text"><i class="bi bi-filetype-json"></i></span>
                  <input type="text" class="form-control filename" name="filename" value="" required>
                  <span class="input-group-text">.wc3.json</span>
                  <button type="submit" class="btn btn-lg btn-primary"> UPLOAD </button>
                </div>
                <div class="form-text text-end mt-0 mb-2"><i class="bi bi-info-circle"></i> 레이어 정보가 같이 저장됩니다.</div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      window.addEventListener('load',(event)=>{
        document.querySelector('#modal-file-upload').addEventListener('show.bs.modal', event => {
          const target = event.target;
          if(editor.document){
            target.querySelectorAll('.filename').forEach(el => { el.value = editor.document.name });
          }
        })
      })
    </script>
        
    <div class="modal fade" id="modal-file-new"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-file-earmark-plus"></i> NEW</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form name="form_new" action="" onsubmit="editor.newDocument(this.width.value,this.height.value); return false;">
              <div class="d-flex flex-column gap-3">
                <div>
                  <div class="input-group input-group-lg">
                    <input type="number" class="form-control" name="width" placeholder="width" min="1" max="10000" value="300">
                    <span class="input-group-text" >X</span>
                    <input type="number" class="form-control" name="height" placeholder="height" min="1" max="10000" value="300">
                    
                  </div>
                </div>
                <div class="text-end">
                  <button class="w-100 btn btn-lg btn-primary">Create</button>
                </div>
                <hr class="my-1">
                <div>
                  <div class="form-label m-0"><i class="bi bi-square"></i> Square</div>
                  <div class="grid-auto-fill grid-auto-fill-80px gap-1">
                    <button type="button" class="btn btn-sm btn-success" onclick="this.form.width.value=100;this.form.height.value=100;">100x100</button>
                    <button type="button" class="btn btn-sm btn-success" onclick="this.form.width.value=200;this.form.height.value=200;">200x200</button>
                    <button type="button" class="btn btn-sm btn-success" onclick="this.form.width.value=300;this.form.height.value=300;">300x300</button>
                    <button type="button" class="btn btn-sm btn-success" onclick="this.form.width.value=600;this.form.height.value=600;">600x600</button>
                    <button type="button" class="btn btn-sm btn-success" onclick="this.form.width.value=800;this.form.height.value=800;">800x800</button>
                  </div>
                </div>
                <div>
                  <div class="form-label m-0"><i class="bi bi-file-image"></i> Portrait</div>
                  <div class="grid-auto-fill grid-auto-fill-80px gap-1">
                    <button type="button" class="btn btn-sm btn-success" onclick="this.form.width.value=300;this.form.height.value=400;">300x400</button>
                    <button type="button" class="btn btn-sm btn-success" onclick="this.form.width.value=480;this.form.height.value=640;">480x640</button>
                    <button type="button" class="btn btn-sm btn-success" onclick="this.form.width.value=600;this.form.height.value=800;">600x800</button>
                    <button type="button" class="btn btn-sm btn-success" onclick="this.form.width.value=768;this.form.height.value=1024;">768x1024</button>
                  </div>
                </div>
                <div>
                  <div class="form-label m-0"><i class="bi bi-card-image"></i> Landscape</div>
                  <div class="grid-auto-fill grid-auto-fill-80px gap-1">
                    <button type="button" class="btn btn-sm btn-success" onclick="this.form.width.value=400;this.form.height.value=300;">400x300</button>
                    <button type="button" class="btn btn-sm btn-success" onclick="this.form.width.value=640;this.form.height.value=480;">640x480</button>
                    <button type="button" class="btn btn-sm btn-success" onclick="this.form.width.value=800;this.form.height.value=600;">800x600</button>
                    <button type="button" class="btn btn-sm btn-success" onclick="this.form.width.value=1024;this.form.height.value=768;">1024x768</button>
                  </div>
                </div>
                
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
        
    <div class="modal modal-xl fade" id="modal-text-config"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-alphabet-uppercase"></i> Text</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="d-flex flex-wrap gap-3">
              <div>
                <div class="form-label mb-0"><i class="bi bi-info-circle"></i> Action</div>
                <div class="d-flex gap-1">
                  <button class="btn btn-primary" onclick="editor.tool.confirm();"><i class="bi bi-check"></i> Confirm</button>
                  <button class="btn btn-warning" onclick="editor.tool.cancel();"><i class="bi bi-x"></i> Cancel</button>
                </div>
              </div>
            </div>
            <hr>
            <form name="form_text" action=""
                xoninput="editor?.document?.layer?.setText(this.text.value);editor?.document?.layer?.flush();"
                xonblur="editor.document.history.save('text config')"
                oninput="{
                  const textlayer = editor?.document?.layer
                  textlayer.setText(this.text.value);
                  textlayer.flush();
                  Wc.HtmlUtil.applyStyleObject(document.querySelector('#form-text-text'),textlayer.textConfig.exportToStyleObject())
                } return false;"
                data-wc-sync-form="editor.document.layer"
              >
              <div>
                <div class="form-text mb-0">Text</div>
                <textarea id="form-text-text" name="text" rows="5" class="form-control" style="height: 200px;"></textarea>
              </div>
            </form>
            <hr>
            <form name="form_textConfig" class=""
              oninput="{
                  const textlayer = editor?.document?.layer
                  textlayer.setTextConfig(Wc.HtmlUtil.formToObject(this));
                  textlayer.flush();
                  Wc.HtmlUtil.applyStyleObject(document.querySelector('#form-text-text'),textlayer.textConfig.exportToStyleObject())
                }              
              " 
              onchange="this.oninput(event);"
              
              data-wc-sync-form="editor.document.layer.textConfig"
              >
              <div class="div-text-config grid-auto-fill grid-auto-fill-260px gap-3">
                <div>
                  <div class="form-label mb-0"><i class="bi bi-palette"></i> Color</div>
                  <label class="input-group" role="button" for="btn-palette-textColor">
                    <input type="color" readonly class="form-control form-control-color pe-none" name="textColor" value="#000000">
                    <button type="button" class="btn btn-outline-light wc-bg-textColor pe-none" data-wc-target-color="textColor" data-bs-toggle="modal" data-bs-target="#modal-color-palette" id="btn-palette-textColor" style="text-shadow: 1px 0px 1px black;"><i class="bi bi-palette" style="color: #fff;"></i></button>
                  </label>
                </div>
                
                <div>
                  <div class="form-label mb-0"><i class="bi bi-type"></i> fontFamily</div>
                  <select name="fontFamily" class="form-select">
                    <option value="sans-serif">sans-serif (기본 글꼴)</option>
                    <option value="serif">serif</option>
                    <option value="Arial">Arial</option>
                    <option value="Verdana">Verdana</option>
                    <option value="Helvetica">Helvetica</option>
                    <option value="Times New Roman">Times New Roman</option>
                    <option value="Georgia">Georgia</option>
                    <option value="Courier New">Courier New</option>
                    <option value="Lucida Console">Lucida Console</option>
                    <option value="Trebuchet MS">Trebuchet MS</option>
                    <option value="Impact">Impact</option>
                    <option value="Comic Sans MS">Comic Sans MS</option>
                    <option value="Tahoma">Tahoma</option>
                    <option value="Palatino Linotype">Palatino Linotype</option>
                    <option value="Garamond">Garamond</option>
                    <option value="Brush Script MT">Brush Script MT</option>
                    <option value="monospace">monospace</option>
                    <option value="cursive">cursive</option>
                    <option value="fantasy">fantasy</option>
                    <option value="Black Han Sans">(WEB FONT)Black Han Sans</option>
                  </select>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-plus-slash-minus"></i> fontSize(px)</div>
                  <div class="input-group ui-input-stepper">
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                    <div class="form-control ui-input-stepper-data-value" data-value-suffix="px" >
                      <input type="range" class="form-range d-block" name="fontSizeNumber" min="1" max="200" step="1"  value="10">
                    </div>
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                  </div>
                </div>
                <div class="d-flex gap-1">
                  <div class="flex-1">
                    <div class="form-label mb-0"><i class="bi bi-type-bold"></i> fontWeight</div>
                    <select name="fontWeight" class="form-select">
                      <option value="normal">normal</option>
                      <option value="bold">bold</option>
                      <!-- <option value="bolder">bolder</option> -->
                      <!-- <option value="lighter">lighter</option> -->
                      <option value="100">100</option>
                      <option value="200">200</option>
                      <option value="300">300</option>
                      <option value="400">400 (normal)</option>
                      <option value="500">500</option>
                      <option value="600">600</option>
                      <option value="700">700 (bold)</option>
                      <option value="800">800</option>
                      <option value="900">900</option>
                    </select>
                  </div>
                  <div class="flex-1">
                    <div class="form-label mb-0"><i class="bi bi-type-italic"></i> fontStyle</div>
                    <select name="fontStyle" class="form-select">
                      <option value="normal">normal</option>
                      <option value="italic">italic</option>
                    </select>
                  </div>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-distribute-vertical"></i> lineHeight(em)</div>
                  <div class="input-group ui-input-stepper">
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                    <div class="form-control ui-input-stepper-data-value" data-value-suffix="em" >
                      <input type="range" class="form-range d-block" name="lineHeightNumber" min="0.1" max="5" step="0.1"  value="1.5">
                    </div>
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                  </div>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-distribute-horizontal"></i> letterSpacing</div>
                  <div class="input-group ui-input-stepper">
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                    <div class="form-control ui-input-stepper-data-value" data-value-suffix="px" >
                      <input type="range" class="form-range d-block" name="letterSpacingNumber" min="-50" max="50" step="0.1"  value="0">
                    </div>
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                  </div>
                  <div class="form-text text-end">* 사파리 브라우저 지원 안함</div>
                </div>
                <div class="d-flex gap-1">
                  <div class="flex-1">
                    <div class="form-label mb-0"><i class="bi bi-align-center"></i> textAlign</div>
                    <select name="textAlign" class="form-select">
                      <option value="start">start</option>
                      <option value="end">end</option>
                      <option value="left">left</option>
                      <option value="center">center</option>
                      <option value="right">right</option>
                    </select>
                  </div>
                  <div class="flex-1">
                    <div class="form-label mb-0"><i class="bi bi-align-middle"></i> verticalAlign</div>
                    <select name="verticalAlign" class="form-select">
                      <option value="top">top</option>
                      <option value="middle">middle</option>
                      <option value="bottom">bottom</option>
                    </select>
                  </div>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-distribute-horizontal"></i> padding</div>
                  <div class="input-group ui-input-stepper">
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                    <div class="form-control ui-input-stepper-data-value" data-value-suffix="px" >
                      <input type="range" class="form-range d-block" name="paddingNumber" min="-100" max="100" step="1"  value="0">
                    </div>
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                  </div>
                  <input type="hidden" name="paddingUnit" value="px">
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-signpost-split"></i> direction</div>
                  <select name="direction" class="form-select">
                    <option value="ltr">Left to Right (기본값)</option>
                    <option value="rtl">Right to Left (아랍어, 히브리어 등)</option>
                  </select>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-alphabet"></i> fontKerning(자동 자간 조정)</div>
                  <select name="fontKerning" class="form-select">
                    <option value="auto">auto (기본값)</option>
                    <option value="normal">normal</option>
                    <option value="none">none</option>
                  </select>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-arrow-return-left"></i> whiteSpace(공백처리,자동줄바꿈)</div>
                  <select name="whiteSpace" class="form-select">
                    <optgroup label="추천">
                      <option value="break-spaces">break-spaces (최대한 자동 줄바꿈)</option>
                      <option value="pre">pre (자동 줄바꿈 없음)</option>
                    </optgroup>
                    <optgroup label="비추천">
                      <option value="pre-wrap">pre-wrap (줄바꿈+자동줄바꿈+뒷공백유지)</option>
                      <option value="pre-line">pre-line (줄바꿈+자동줄바꿈+공백압축)</option>
                      <option value="nowrap">nowrap (줄바꿈금지+공백압축)</option>
                      <option value="normal">normal (줄바꿈금지+공백압축+자동줄바꿈)</option>
                    </optgroup>
                    
                  </select>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-arrow-return-left"></i> wordBreak(줄바꿈 설정)</div>
                  <select name="wordBreak" class="form-select">
                    <option value="normal">normal (기본값)(이거 써야하나.. keep-all 이 좋을 듯)</option>
                    <option value="break-all">break-all (글자 단위 줄바꿈)</option>
                    <option value="keep-all">keep-all (단어 단위 줄바꿈)</option>
                  </select>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-arrow-return-left"></i> overflowWrap(문장이 넘칠 경우 설정)</div>
                  <select name="overflowWrap" class="form-select">
                    <option value="normal">normal (밖으로까지 그린다.)</option>
                    <option value="break-word">break-word (한 줄에서 넘어가면 줄 바꿈한다.)</option>
                  </select>
                </div>

                
                <!-- fontStretch 지원 안되나? 나중에 다시 테스트해보자  -->
                <!-- fontVariantCaps 지원 안할꺼라 -->
                
                
              </div>
              
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      document.getElementById('modal-text-config').addEventListener('show.bs.modal', event => {
        const textlayer = editor?.document?.layer
        Wc.HtmlUtil.applyStyleObject(document.querySelector('#form-text-text'),textlayer.textConfig.exportToStyleObject())
        // editor.ready();
      })
    </script>

    <div class="modal fade" id="modal-layers"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-layers"></i> Layers</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body pb-0" style="flex:0 0 auto">
            <div class="d-flex flex-column gap-3">
              <div class="d-flex justify-content-end gap-1">
                <div class="btn-group" role="group">
                  <button type="button" class="btn btn-primary" title="add layer" onclick="editor?.document?.layers.addLayer();editor?.document?.layer.flush();"><i class="bi bi-file-plus"></i></button>
                  
                  <button type="button" class="btn btn-outline-primary" title="add other layer" data-bs-toggle="modal" data-bs-target="#modal-insert-layer" ><i class="bi bi-three-dots"></i></button>
                </div>

                <button type="button" class="btn btn-primary" title="copy" onclick="editor?.document?.layers.cloneLayer();editor?.document?.layer.flush();editor?.document.ready(); "><i class="bi bi-copy"></i></button>
                <button type="button" class="btn btn-primary" title="merge down" onclick="editor?.document.layers.mergeDown()"><i class="bi bi-union"></i></button>
                <button type="button" class="btn btn-primary" title="clear" onclick="editor?.document?.layer.clear();editor?.document?.layer.flush();editor?.document.ready();editor?.document?.history.save('layer.clear')"><i class="bi bi-eraser-fill"></i></button>
                
                <div class="btn-group" role="group">
                  <button type="button" class="btn btn-primary" title="up" onclick="editor?.document.layers.moveUp()"><i class="bi bi-layer-forward"></i></button>
                  <button type="button" class="btn btn-primary" title="down" onclick="editor?.document.layers.moveDown()"><i class="bi bi-layer-backward"></i></button>
                </div>
                <button type="button" class="btn btn-danger" title="delete" onclick="if(!confirm('Remove?')){return;} editor?.document?.layers.remove();editor?.document?.layer.flush()"><i class="bi bi-trash"></i></button>
                

              </div>
              <div class="d-flex justify-content-end gap-1 flex-fill">
                <div class="col">
                  <div class="form-label mb-0"><i class="bi bi-intersect"></i> Composite</div>
                  <select name="compositeOperation" id="layer-composite-operation" class="form-select"
                    oninput="if(editor?.document?.layer){ editor.document.layer.compositeOperation = this.value; editor.document.layer.flush(); editor.document.layers.ready()}"
                    x-data-wc-sync-from="editor.document.layer.compositeOperation"
                    >
                    <option value="source-over">source-over</option>
                    <option value="source-in">source-in</option>
                    <option value="source-out">source-out</option>
                    <option value="source-atop">source-atop</option>
                    <option value="destination-over">destination-over</option>
                    <option value="destination-in">destination-in</option>
                    <option value="destination-out">destination-out</option>
                    <option value="destination-atop">destination-atop</option>
                    <option value="lighter">lighter</option>
                    <option value="copy">copy</option>
                    <option value="xor">xor</option>
                    <option value="multiply">multiply</option>
                    <option value="screen">screen</option>
                    <option value="overlay">overlay</option>
                    <option value="darken">darken</option>
                    <option value="lighten">lighten</option>
                    <option value="color-dodge">color-dodge</option>
                    <option value="color-burn">color-burn</option>
                    <option value="hard-light">hard-light</option>
                    <option value="soft-light">soft-light</option>
                    <option value="difference">difference</option>
                    <option value="exclusion">exclusion</option>
                    <option value="hue">hue</option>
                    <option value="saturation">saturation</option>
                    <option value="color">color</option>
                    <option value="luminosity">luminosity</option>
                  </select>
                </div>
                <div class="col">
                  <div class="form-label mb-0"><i class="bi bi-transparency"></i> alpha</div>
                  <div class="form-control ui-input-stepper ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0"  onchange="editor.document.history.save()">
                    <input type="range" class="form-range m-0 d-block" id="layer-alpha" min="0" max="1" value="1" step="0.01"
                      oninput="if(editor?.document?.layer){ editor.document.layer.alpha = this.value; editor.document.layer.flush(); editor.document.layers.ready()}"
                      x-data-wc-sync-from="editor.document.layer.alpha"
                      >
                  </div>
                </div>
              </div>
              <hr class="my-1">
            </div>
          </div>
          <div class="modal-body">
            
            <div class="d-flex flex-column gap-3" style="max-height: max-content; height: 100%;">
              
              <div class="d-flex flex-column gap-3">
                <template id="template-layer-box" >
                  <div class="layer-box d-flex gap-1 align-items-center p-1" role="button">
                    <button class="btn layer-box-eye d-flex justify-content-center align-items-center p-0 m-0 px-2">
                      <i class="bi bi-eye on-visible"></i>
                      <i class="bi bi-eye-slash no-visible"></i>
                    </button>
                    <button class="btn layer-box-content text-start flex-fill d-flex gap-1 align-items-center p-0 m-0" style="min-width: 0">
                      <div class="layer-box-preview">canvas</div>
                      <div class="layer-box-detail  flex-fill" style="min-width: 0;">
                        <div>
                          <div class="layer-box-detail-name text-truncate"></div>
                        </div>
                        <small class="d-flex flex-wrap gap-2 row-gap-1">
                          <div class="d-flex gap-1">
                            <div><i class="bi bi-bounding-box"></i></div>
                            <div class="layer-box-detail-size"></div>
                          </div>
                          <div class="d-flex gap-1">
                            <div><i class="bi bi-zoom-in"></i></div>
                            <div class="layer-box-detail-zoom"></div>
                          </div>
                          <div class="d-flex gap-1">
                            <div><i class="bi bi-transparency"></i></div>
                            <div class="layer-box-detail-alpha"></div>
                          </div>
                          <div class="d-flex gap-1 icons icons-d-none icon-flips">
                            <div class="icon icon-flip-x"><i class="bi bi-symmetry-vertical"></i></div>
                            <div class="icon icon-flip-y"><i class="bi bi-symmetry-horizontal"></i></div>
                          </div>
                        </small>
                      </div>
                    </button>
                    <button class="btn layer-box-config d-flex justify-content-center align-items-center p-0 m-0 px-2" x-data-bs-toggle="modal" x-data-bs-target="#modal-layer-config">
                      <i class="bi bi-sliders"></i>
                    </button>
                  </div>
                </template>
                <div class="layer-box-container d-flex flex-column gap-3">
                  
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>
    <script>
      window.addEventListener('load',(event)=>{
        document.getElementById('modal-layers').addEventListener('show.bs.modal', event => {
          editor.ready();
        })
        // 현재로썬 draw 이벤트로 반응할 필요가 없다.
        // document.querySelector('.layer-box-container').addEventListener('draw',(event)=>{
        //   editor.ready();
        // })
        
      },{once:true})
    </script>

    <div class="modal fade" id="modal-layer-config"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-layers-half"></i> Layer</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body border-bottom"  style="flex:0 0 auto;">
            <div class="d-flex flex-wrap gap-3">
              <div>
                <div class="form-label mb-0"><i class="bi bi-zoom-in"></i> Zoom</div>
                <div class="d-flex flex-row gap-1">
                  <button class="btn btn-primary" onclick="editor.temp.selectedLayer.zoom=1;editor.temp.selectedLayer.flush();editor.saveHistory(); wcSyncHandler.sync(this.closest('.modal'))">100%</button>
                </div>
              </div>
              <div>
                <div class="form-label mb-0"><i class="bi bi-arrows-move"></i> Postion</div>
                <div class="d-flex flex-row gap-1">
                  <button class="btn btn-primary" onclick="editor.temp.selectedLayer.postionCenterCenter();editor.temp.selectedLayer.flush();editor.saveHistory(); wcSyncHandler.sync(this.closest('.modal'))">CENTER</button>
                </div>
              </div>
              <div>
                <div class="form-label mb-0"><i class="bi bi-bounding-box"></i> Resize</div>
                <div class="d-flex flex-row gap-1">
                  <button class="btn btn-primary" onclick="editor.temp.selectedLayer.adjustSize(editor.temp.selectedLayer.parent.width,editor.temp.selectedLayer.parent.height);editor.temp.selectedLayer.flush();editor.saveHistory();editor.tool.activate(); wcSyncHandler.sync(this.closest('.modal'))">Adjust size to document</button>
                </div>
              </div>
              <div>
                <div class="form-label mb-0"><i class="bi bi-arrow-clockwise"></i> Rotation</div>
                <div class="d-flex flex-row gap-1">
                  <button class="btn btn-primary" onclick="editor.temp.selectedLayer.angle=0;editor.temp.selectedLayer.flush();editor.saveHistory();editor.tool.activate(); wcSyncHandler.sync(this.closest('.modal'))">0°</button>
                  <button class="btn btn-primary" onclick="editor.temp.selectedLayer.angle=90;editor.temp.selectedLayer.flush();editor.saveHistory();editor.tool.activate(); wcSyncHandler.sync(this.closest('.modal'))">90°</button>
                  <button class="btn btn-primary" onclick="editor.temp.selectedLayer.angle=180;editor.temp.selectedLayer.flush();editor.saveHistory();editor.tool.activate(); wcSyncHandler.sync(this.closest('.modal'))">180°</button>
                  <button class="btn btn-primary" onclick="editor.temp.selectedLayer.angle=-90;editor.temp.selectedLayer.flush();editor.saveHistory();editor.tool.activate(); wcSyncHandler.sync(this.closest('.modal'))">270°</button>
                </div>
              </div>
              <div>
                <div class="form-label mb-0"><i class="bi bi-filetype-png"></i> Export</div>
                <div class="d-flex flex-row gap-1">
                  <button class="btn btn-primary" onclick="Wc.HtmlUtil.saveAsCanvas(editor.temp.selectedLayer);">EXPORT PNG</button>
                </div>
              </div>
              
            </div>
          </div>
          <div class="modal-body">
            <div class="d-flex flex-column gap-3 ">
              <form name="form_layer_resize" class="flex-fill" action="" onsubmit="
                if(editor.temp?.selectedLayer){
                  const layer = editor.temp.selectedLayer
                  layer.resize(this.width.value,this.height.value);
                  layer.flush();
                  editor.document.layers.ready();
                  editor.document.history.save();
                } return false"
                data-wc-sync-form="editor.temp.selectedLayer"
                >
                <div>
                  <div class="form-label mb-0"><i class="bi bi-bounding-box"></i> Size</div>
                  <div class="input-group">
                    <input class="form-control" type="number" name="width" placeholder="width" min="1" max="10000">
                    <span class="input-group-text" >X</span>
                    <input class="form-control" type="number" name="height" placeholder="height" min="1" max="10000">
                    <button type="submit"  style="width:6em" class="btn btn-primary">Resize</button>
                  </div>
                </div>
              </form>
              <form name="form_layer_zoom" class="flex-fill d-flex flex-column gap-3" action=""
                xoninput="
                if(this.closest('.modal')?.layer){
                  const layer = this.closest('.modal')?.layer
                  layer.zoom=parseFloat(this.zoom.value);
                  layer.flush();
                  editor.document.layers.ready();
                }"
                onchange="this.oninput(event); editor.document.history.save(); return false;"
                oninput="if(editor.temp?.selectedLayer){ const layer = editor.temp.selectedLayer; Object.assign(layer,Wc.HtmlUtil.formToObject(this));layer.flush();editor.document.layers.ready(); }"
                data-wc-sync-form="editor.temp.selectedLayer"
                >
                <div>
                  <div class="form-label mb-0"><i class="bi bi-transparency"></i> Alpha</div>
                  <div class="input-group ui-input-stepper">
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                    <div class="form-control ui-input-stepper ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0">
                      <input type="range" class="form-range m-0 d-block"name="alpha"  min="0" max="1" value="1" step="0.01" >
                    </div>
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                  </div>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-zoom-in"></i>  Zoom</div>
                  <div class="input-group ui-input-stepper">
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                    <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0">
                      <input class="form-range d-block" type="range" name="zoom" placeholder="zoom" step="0.01" min="0" max="3" >
                    </div>
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                  </div>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-radar"></i> Angle</div>
                  <div class="input-group  ui-input-stepper">
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                    <div class="form-control ui-input-stepper-data-value" data-value-suffix="°"  onchange="editor.document.history.save()">
                      <input type="range" class="form-range d-block" name="angle" placeholder="angle" step="1" min="-180" max="180" value="0" >
                    </div>
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                  </div>
                </div>
                <div class="d-flex gap-1">
                  <div class="col">
                    <div class="form-label mb-0"><i class="bi bi-symmetry-vertical"></i> Flip X</div>
                    <select name="flipX" class="form-select" >
                      <option value="1">Normal</option>
                      <option value="-1">Flip X</option>
                    </select>
                  </div>
                  <div class="col">
                    <div class="form-label mb-0"><i class="bi bi-symmetry-horizontal"></i> Flip Y</div>
                    <select name="flipY" class="form-select" >
                      <option value="1">Normal</option>
                      <option value="-1">Flip Y</option>
                    </select>
                  </div>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-arrows-move"></i> Postion</div>
                  <div class="input-group w-100">
                    <span class="input-group-text justify-content-center" style="width:4em" >Left</span>
                    <input class="form-control" type="number" name="left" placeholder="left" min="-10000" max="10000">
                    <span class="input-group-text justify-content-center" style="width:4em" >Top</span>
                    <input class="form-control" type="number" name="top" placeholder="top" min="-10000" max="10000">
                  </div>
                </div>
                
                
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal-insert-layer"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-layers-half"></i><i class="bi bi-file-plus"></i> Insert layer</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form action="" onsubmit="if(this.openfile.files.length){ editor.insertLayerFromFile(this.openfile.files[0]); this.reset() }else{ alert('Select a file(image file)')}; return false;" >
              <div>
                <div class="form-text mb-0">Insert Layer</div>
                <div class="d-flex gap-3">
                  <button type="button" class="btn btn-primary" onclick="editor?.document?.layers.addLayer();editor?.document?.layer.flush();"><i class="bi bi-file-plus"></i> Normal Layer</button>
                  <button type="button" class="btn btn-primary" 
                  onclick="
                  editor?.document?.layers.addLayer('TextLayer');
                  editor.document.layer.textConfig.textColor = editor.contextConfig.foreColor; 
                  editor.document.layer.flush();
                  editor.ready();"><i class="bi bi-file-text"></i> Text layer</button>
                </div>
              </div>
              <hr>
              <h5>Local image file</h5>
              <div class="input-group input-group">
                <input type="file" class="form-control" name="openfile" accept="image/*">
                <button type="submit" class="btn btn-primary" ><i class="bi bi-file-plus"></i> insert</button>
              </div>
              <div class="form-text text-end"><i class="bi bi-info-circle"></i> image 파일만 지원됩니다.</div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal-document-config"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-file-earmark-image"></i> Document</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body border-bottom"  style="flex:0 0 auto;">
            <div class="d-flex flex-wrap gap-3">
              <div>
                <div class="form-label mb-0"><i class="bi bi-zoom-in"></i> Zoom</div>
                <div class="d-flex flex-row gap-1 justify-content-start flex-wrap">
                  <button class="btn btn-primary" onclick="editor.document.zoom=1;editor.document.flush();wcSyncHandler.sync(this.closest('.modal'))">100%</button>
                  <button class="btn btn-primary" onclick="WcHelper.wcAppZoomFit();wcSyncHandler.sync(this.closest('.modal'))">Fit Auto</button>
                  <button class="btn btn-primary" onclick="WcHelper.wcAppZoomFit('width');wcSyncHandler.sync(this.closest('.modal'))">Fit Width</button>
                  <button class="btn btn-primary" onclick="WcHelper.wcAppZoomFit('height');wcSyncHandler.sync(this.closest('.modal'))">Fit Height</button>
                </div>
              </div>
              <div>
                <div class="form-label mb-0"><i class="bi bi-arrows-move"></i> Position</div>
                <div>
                  <button class="btn btn-primary" onclick="editor.document.left=0;editor.document.top=0;editor.document.flush();wcSyncHandler.sync(this.closest('.modal'))">CENTER</button>
                </div>
                
              </div>
            </div>
          </div>
          <div class="modal-body">
            <div class="d-flex flex-column gap-3">
              <form name="form_document_resize" class="flex-fill" action="" onsubmit="
                if(editor?.document){
                  editor.document.resize(this.width.value,this.height.value);
                  editor.document.flush();
                  editor.document.layers.ready();
                  // editor.document.history.save();
                } return false"
                data-wc-sync-form="editor.document"
                >
                <div>
                  <div class="form-label mb-0"><i class="bi bi-bounding-box"></i> size</div>
                  <div class="input-group">
                    <input class="form-control" type="number" name="width" placeholder="width" min="1" max="10000">
                    <span class="input-group-text" >X</span>
                    <input class="form-control" type="number" name="height" placeholder="height" min="1" max="10000">
                    <button type="submit"  style="width:6em" class="btn btn-primary">Resize</button>
                  </div>
                </div>
              </form>
              <form  class="d-flex flex-column gap-3" action=""
                x-onchange="this.oninput(event); editor.document.history.save(); return false;"
                oninput="if(editor?.document){ const document = editor.document; Object.assign(document,Wc.HtmlUtil.formToObject(this));document.flush(); }"
                data-wc-sync-form="editor.document"
                >
                <div>
                  <div class="form-label mb-0"><i class="bi bi-zoom-in"></i> Zoom</div>
                  <div class="input-group ui-input-stepper" >
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                    <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0">
                      <input class="form-range d-block" type="range" name="zoom" placeholder="zoom" step="0.01" min="0" max="3" >
                    </div>
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                  </div>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-radar"></i> Angle</div>
                  <div class="input-group ui-input-stepper" >
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                    <div class="form-control ui-input-stepper-data-value" data-value-suffix="°"  onchange="editor.document.history.save()">
                      <input type="range" class="form-range d-block" name="angle" placeholder="angle" step="1" min="-180" max="180" value="0" >
                    </div>
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                  </div>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-arrows-move"></i> Position</div>
                  <div class="d-flex gap-1">
                    <div class="col">
                      <div class="form-label mb-0">left</div>
                      <input class="form-control" type="number" name="left" placeholder="left" min="-10000" max="10000">
                    </div>
                    <div class="col">
                      <div class="form-label mb-0">top</div>
                      <input class="form-control" type="number" name="top" placeholder="top" min="-10000" max="10000">
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modal-autosave"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-robot"></i> Auto Save</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="d-flex flex-column gap-3">
              <button class="btn btn-primary" id="btn-autosave-load" type="button" onclick="if(confirm(`${dayjs(Wc.autoSave.updatedAt).format('YYYY-MM-DD HH:mm:ss')} 의 데이터를 불러올까요?`)){ Wc.autoSave.load();}">Load last save: <span id="autosave-updatedat"></span></button>
              <button class="btn btn-primary" id="btn-autosave-save" type="button" onclick="if(confirm(`현재 데이터로 임시 저장할까요?`)){ Wc.autoSave.save();}">Save now</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      document.querySelector('#modal-autosave').addEventListener('show.bs.modal',event =>{
        const autosaveUpdatedat = document.querySelector('#autosave-updatedat');
        const btn = document.querySelector('#btn-autosave-load');
        if(Wc.autoSave.updatedAt){
          autosaveUpdatedat.textContent = dayjs(Wc.autoSave.updatedAt).format('YYYY-MM-DD HH:mm:ss')
          btn.disabled = false;
        }else{
          autosaveUpdatedat.textContent = 'NO-DATA';
          btn.disabled = true;
        }
        console.log(Wc.autoSave.updatedAt);
        
      })
    </script>

    <div class="modal fade" id="modal-transform-config"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-bounding-box"></i> Transform</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body border-bottom" onclick="wcSyncHandler.sync(this.closest('.modal'))">
            <div class="d-flex flex-wrap gap-3">
              <div>
                <div class="form-label mb-0"><i class="bi bi-info-circle"></i> Action</div>
                <div class="d-flex gap-1">
                  <button class="btn btn-primary" onclick="editor.tool.confirm();"><i class="bi bi-check"></i> Confirm</button>
                  <button class="btn btn-warning" onclick="editor.tool.cancel();"><i class="bi bi-x"></i> Cancel</button>
                </div>
              </div>
              <div>
                <div class="form-label mb-0"><i class="bi bi-arrows-move"></i> Postion</div>
                <div class="d-flex gap-1">
                  <button class="btn btn-primary" onclick="editor.tool.center();">Center</button>
                </div>
              </div>
              <div>
                <div class="form-label mb-0"><i class="bi bi-bounding-box"></i> Resize</div>
                <div class="d-flex gap-1">
                  <button class="btn btn-primary" onclick="let layer = editor?.document?.layer;if(!layer){return} layer.adjustSize(layer.parent.width,layer.parent.height);layer.flush();editor.saveHistory();editor.tool.activate();">ADJUST SIZE TO DOCUMENT</button>
                </div>
              </div>
              
              
            </div>
          </div>
          <div class="modal-body">
            <div class="d-flex flex-column flex-wrap gap-3">
              
              <hr>
              <form  class="d-flex flex-column gap-3" action="" data-wc-sync-form="editor.document.drawingLayer" >
                <div class="input-group w-100">
                  <span class="input-group-text justify-content-center" style="width:6em" >Size</span>
                  <input class="form-control" type="number" name="width" placeholder="width" min="1" max="10000" oninput="editor.document.drawingLayer.width = this.value; editor.tool.readyUtt(); editor.tool.draw();">
                  <span class="input-group-text" >X</span>
                  <input class="form-control" type="number" name="height" placeholder="height" min="1" max="10000" oninput="editor.document.drawingLayer.height = this.value; editor.tool.readyUtt(); editor.tool.draw();">
                  <!-- <button type="submit"  style="width:6em" class="btn btn-primary">Resize</button> -->
                </div>
                <div class="input-group">
                  <span class="input-group-text justify-content-center" style="width:4em" >Left</span>
                  <input class="form-control" type="number" name="left" placeholder="left" min="-10000" max="10000" oninput="editor.document.drawingLayer.left = this.value; editor.tool.readyUtt(); editor.tool.draw();">
                  <span class="input-group-text justify-content-center" style="width:4em" >Top</span>
                  <input class="form-control" type="number" name="top" placeholder="top" min="-10000" max="10000" oninput="editor.document.drawingLayer.top = this.value; editor.tool.readyUtt(); editor.tool.draw();">
                </div>
              </form>
              
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal modal-xl fade" id="modal-brush-config"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content brush-config-container">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-brush"></i> <i class="bi bi-sliders"></i> <span class="modal-config-title">Brush config</span></h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body brush-preview border-bottom p-0" style="flex:0 0 auto;">
            <div class="brush-wrap text-center d-none justify-content-center align-items-center mx-auto" style="height: 200px;">
              <canvas id="brush0" data-brush-key="brush0" is="wc-brush" class="wc-brush" width="5" height="5"></canvas>
            </div>
            <div class="brush-wrap brush-preview-canvas-wrap text-center d-flex justify-content-center align-items-center mx-auto">
              <canvas class="brush-preview-canvas d-block mx-auto" is="wc-canvas" width="400" height="100"></canvas>
            </div>
          </div>
          <div class="modal-body brush-config">
            <form name="formBrushConfig" class="form-brush-config" data-brush-key="brush" action="" onsubmit="return false">
              <div class="div-brush-config grid-auto-fill grid-auto-fill-260px gap-3">
                <div>
                  <div class="form-label mb-0"><i class="bi bi-brush"></i> Shape(모양)</div>
                  <select name="shape" class="form-select shape">
                    <option value="circle">circle(원)</option>
                    <option value="square">square(정사각형)</option>
                  </select>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-border-width"></i> Size(크기,지름)</div>
                  <div class="input-group ui-input-stepper">
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                    <div class="form-control ui-input-stepper-data-value" data-value-suffix="px" >
                      <input type="range" class="form-range d-block" name="size" placeholder="size" min="1" max="200" step="1"  value="5">
                    </div>
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                  </div>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-transparency"></i> Opacity(스트로크 불투명도)</div>
                  <div class="input-group ui-input-stepper">
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                    <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                      <input type="range" class="form-range d-block" name="opacity" placeholder="opacity" step="0.01" min="0" max="1" value="1" >
                    </div>
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                  </div>
                </div>
                <div>
                  <div class="form-label mb-0"><i class="bi bi-transparency"></i> Flow(브러시 자국 불투명도)</div>
                  <div class="input-group ui-input-stepper">
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                    <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                      <input type="range" class="form-range d-block" name="flow" placeholder="flow" step="0.01" min="0" max="1" value="1" >
                    </div>
                    <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                  </div>
                </div>
              </div>
              <hr>
              <div class="brush-nav-container mt-3" data-brush-tab="brush">
                <ul class="nav nav-tabs">
                  <li class="nav-item">
                    <button type="button" class="nav-link active" data-brush-tab="brush" onclick="WcHelper.brushNavTab(this)" >Brush</button>
                  </li>
                  <li class="nav-item">
                    <button type="button" class="nav-link" data-brush-tab="config" onclick="WcHelper.brushNavTab(this)" >Config</button>
                  </li>
                </ul>
                <div class="mt-3">
                  <div class="brush-nav-tab" data-brush-tab="brush">
                    <div class="div-brush-config grid-auto-fill grid-auto-fill-260px gap-3">
                      <header> <h4 class="m-0">Basic brush</h4> </header>
                      <button type="button" class="btn text-start btn-warning btn-reset-config btn-brush-configurator" onclick="Wc.BrushConfigurator.reset(WcHelper.getBrushCanvas(this));"><i class="bi bi-arrow-counterclockwise"></i> Reset</button>
                      <button type="button" class="btn text-start btn-primary btn-brush-configurator" onclick="Wc.BrushConfigurator.pen(WcHelper.getBrushCanvas(this));"><i class="bi bi-pen"></i> Pen</button>
                      <button type="button" class="btn text-start btn-primary btn-brush-configurator" onclick="Wc.BrushConfigurator.softPen(WcHelper.getBrushCanvas(this));"><i class="bi bi-pen"></i> Soft Pen</button>

                      <button type="button" class="btn text-start btn-primary btn-brush-configurator" onclick="Wc.BrushConfigurator.brush(WcHelper.getBrushCanvas(this));"><i class="bi bi-brush"></i> Brush</button>
                      <button type="button" class="btn text-start btn-primary btn-brush-configurator" onclick="Wc.BrushConfigurator.softBrush(WcHelper.getBrushCanvas(this));"><i class="bi bi-brush"></i> Soft Brush</button>
                      <hr class="my-1">
                      <header> <h4 class="m-0">Art brush</h4> </header>
                      <button type="button" class="btn text-start btn-info btn-brush-configurator" onclick="Wc.BrushConfigurator.highlighter(WcHelper.getBrushCanvas(this));"><i class="bi bi-highlighter"></i> Highlighter</button>
                      <button type="button" class="btn text-start btn-info btn-brush-configurator" onclick="Wc.BrushConfigurator.ballpen(WcHelper.getBrushCanvas(this));"><i class="bi bi-pen"></i> Ball Pen</button>
                      <button type="button" class="btn text-start btn-info btn-brush-configurator" onclick="Wc.BrushConfigurator.pencil(WcHelper.getBrushCanvas(this));"><i class="bi bi-pencil"></i></i> Pencil</button>
                      <button type="button" class="btn text-start btn-info btn-brush-configurator" onclick="Wc.BrushConfigurator.dipPen(WcHelper.getBrushCanvas(this));"><i class="bi bi-vector-pen"></i> Dip pen</button>
                      <button type="button" class="btn text-start btn-info btn-brush-configurator" onclick="Wc.BrushConfigurator.inkBrush(WcHelper.getBrushCanvas(this));"><i class="bi bi-brush"></i> Ink Brush</button>
                      <button type="button" class="btn text-start btn-info btn-brush-configurator" onclick="Wc.BrushConfigurator.airbrush(WcHelper.getBrushCanvas(this));"><i class="bi bi-brush"></i> Air Brush</button>
                    </div>
                  </div>
                  <div class="brush-nav-tab" data-brush-tab="config">
                    <div class="div-brush-config grid-auto-fill grid-auto-fill-260px gap-3">
                      <header> <h4 class="m-0">Basic shape (기본 모양)</h4> </header>


                      <div>
                        <div class="form-label mb-0"><i class="bi bi-arrows-collapse-vertical"></i> SacleX(너비 배율)</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                            <input type="range" class="form-range d-block" name="scaleX" placeholder="scaleX" step="0.01" min="0" max="1" value="1" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-arrows-collapse"></i> SacleY(높이 배율)</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                            <input type="range" class="form-range d-block" name="scaleY" placeholder="scaleY" step="0.01" min="0" max="1" value="1" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-radar"></i> Angle(각도)</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="°"  >
                            <input type="range" class="form-range d-block" name="angle" placeholder="angle" step="1" min="-180" max="180" value="0" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-vignette"></i> Hardness(경도)</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0">
                            <input type="range" class="form-range d-block" name="hardness" placeholder="hardness" step="0.01" min="0" max="1" value="1" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>

                      <div>
                        <div class="form-label mb-0"><i class="bi bi-border-style"></i> Spacing(간격)</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                            <input type="range" class="form-range d-block" name="spacing" placeholder="spacing" step="0.05" min="0.05" max="4" value="0.25" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-transparency"></i> FlattenOpacity(균일투명도)</div>
                        <div class="input-group">
                          <select class="form-select " name="flattenOpacity" >
                            <option selected value="false">NO</option>
                            <option value="true">YES</option>
                          </select>
                        </div>
                      </div>
                      <hr class="my-1">
                      <header> <h4 class="m-0">Size control (via stylus pen)</h4> </header>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-border-width"></i> SizeControl</div>
                        <select class="form-select " name="sizeControl" >
                          <option selected value="off">OFF</option>
                          <option value="penPressure">penPressure</option>
                        </select>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-border-width"></i> MininumSizeRatio</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                            <input type="range" class="form-range d-block" name="mininumSizeRatio" placeholder="mininumSizeRatio" step="0.01" min="0" max="1" value="1" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <hr class="my-1">
                      <header> <h4 class="m-0">Flow control (via stylus pen)</h4> </header>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-transparency"></i> FlowControl</div>
                        <select class="form-select " name="flowControl" >
                          <option selected value="off">OFF</option>
                          <option value="penPressure">penPressure</option>
                        </select>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-transparency"></i> MininumFlow</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                            <input type="range" class="form-range d-block" name="mininumFlow" placeholder="mininumFlow" step="0.01" min="0" max="1" value="1" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <hr class="my-1">
                      <header> <h4 class="m-0">Height control (via stylus pen)</h4> </header>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-arrows-vertical"></i> ScaleYControl</div>
                        <div class="input-group">
                          <select class="form-select " name="scaleYControl" >
                            <option selected value="off">OFF</option>
                            <!-- <option value="penPressure">penPressure</option> -->
                            <option value="penTilt">penTilt</option>
                          </select>
                        </div>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-arrows-vertical"></i> MninumScaleY</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                            <input type="range" class="form-range d-block" name="mninumScaleY" placeholder="mninumScaleY" step="0.01" min="0" max="1" value="1" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>

                      <hr class="my-1">
                      <header> <h4 class="m-0">Angle control (via stylus pen)</h4> </header>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-radar"></i> AngleControl</div>
                        <select class="form-select " name="angleControl" >
                          <option selected value="off">OFF</option>
                          <!-- <option value="penPressure">penPressure</option> -->
                          <option value="penTilt">penTilt(기울기)</option>
                          <option value="direction">direction(그리는 방향)</option>
                        </select>
                      </div>
                      <hr class="my-1">
                      <header> <h4 class="m-0">Jitters</h4> </header>

                      <div>
                        <div class="form-label mb-0"><i class="bi bi-palette"></i> HueJitter (Not supported <i class="bi bi-browser-safari"></i>)</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                            <input type="range" class="form-range d-block" name="hueJitter" placeholder="hueJitter" step="0.01" min="0" max="1" value="0" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-brightness-alt-high"></i> SaturationJitter (Not supported <i class="bi bi-browser-safari"></i>)</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                            <input type="range" class="form-range d-block" name="saturationJitter" placeholder="saturationJitter" step="0.01" min="0" max="1" value="0" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-brightness-high"></i> BrightnessJitter (Not supported <i class="bi bi-browser-safari"></i>)</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                            <input type="range" class="form-range d-block" name="brightnessJitter" placeholder="brightnessJitter" step="0.01" min="0" max="1" value="0" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-border-width"></i> SizeJitter</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                            <input type="range" class="form-range d-block" name="sizeJitter" placeholder="sizeJitter" step="0.01" min="0" max="1" value="0" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-transparency"></i> FlowJitter</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                            <input type="range" class="form-range d-block" name="flowJitter" placeholder="flowJitter" step="0.01" min="0" max="1" value="0" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-radar"></i> AngleJitter</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                            <input type="range" class="form-range d-block" name="angleJitter" placeholder="angleJitter" step="0.01" min="0" max="1" value="0" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <hr class="my-1">
                      <header> <h4 class="m-0">Scattering (산란)</h4> </header>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-shuffle"></i> ScatterAmount (퍼지는 정도)</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                            <input type="range" class="form-range d-block" name="scatterAmount" placeholder="scatterAmount" step="0.01" min="0" max="5" value="0" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-shuffle"></i> Axes (양축 스캐터링)</div>
                        <select class="form-select " name="scatterAxes" >
                          <option value="y">y축(라인 수직)</option>
                          <option value="x">x축(라인 방향)</option>
                          <option value="xy">x축과 y축</option>
                        </select>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-shuffle"></i> Count (한번에 그리는 수)</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" >
                            <input type="range" class="form-range d-block" name="scatterCount" placeholder="scatterCount" step="1" min="1" max="10" value="1" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-shuffle"></i> CountJitter (Count 수 변동)</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="%" data-value-multipler="100" data-value-to-fixed="0" >
                            <input type="range" class="form-range d-block" name="scatterCountJitter" placeholder="scatterCountJitter" step="0.01" min="0" max="1" value="0" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>
                      <hr class="my-1">
                      <header> <h4 class="m-0">Build Up Effect (누적효과)</h4> </header>
                      <div>
                        <div class="form-label mb-0"><i class="bi bi-shuffle"></i> Build Up (누적효과 인터벌 타임)</div>
                        <div class="input-group ui-input-stepper">
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="down">-</button>
                          <div class="form-control ui-input-stepper-data-value" data-value-suffix="sec"  data-value-to-fixed="2" >
                            <input type="range" class="form-range d-block" name="buildUpInterval" placeholder="buildUpInterval" step="0.01" min="0" max="1" value="0" >
                          </div>
                          <button type="button" class="btn btn-primary btn-stepper" data-stepper="up">+</button>
                        </div>
                      </div>

                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="modal modal-xl fade" id="modal-brush1-config"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content brush-config-container">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-brush"></i> <i class="bi bi-sliders"></i> <span class="modal-config-title">Brush1 config</span></h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body brush-preview border-bottom p-0" style="flex:0 0 auto;">
            <div class="brush-wrap text-center d-none justify-content-center align-items-center mx-auto" style="height: 200px;">
              <canvas id="brush1" data-brush-key="brush1" is="wc-brush" class="wc-brush" width="5" height="5"></canvas>
            </div>
            <div class="brush-wrap brush-preview-canvas-wrap text-center d-flex justify-content-center align-items-center mx-auto">
              <canvas class="brush-preview-canvas d-block mx-auto" is="wc-canvas" width="400" height="100"></canvas>
            </div>
          </div>
          <div class="modal-body brush-config">
            <form name="formBrush1Config" class="form-brush-config" data-brush-key="brush1" action="" onsubmit="return false">
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="modal modal-xl fade" id="modal-brush2-config"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content brush-config-container">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-brush"></i> <i class="bi bi-sliders"></i> <span class="modal-config-title">Brush2 config</span></h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body brush-preview border-bottom p-0" style="flex:0 0 auto;">
            <div class="brush-wrap text-center d-none justify-content-center align-items-center mx-auto" style="height: 200px;">
              <canvas id="brush2" data-brush-key="brush2" is="wc-brush" class="wc-brush" width="5" height="5"></canvas>
            </div>
            <div class="brush-wrap brush-preview-canvas-wrap text-center d-flex justify-content-center align-items-center mx-auto">
              <canvas class="brush-preview-canvas d-block mx-auto" is="wc-canvas" width="400" height="100"></canvas>
            </div>
          </div>
          <div class="modal-body brush-config">
            <form name="formBrush2Config" class="form-brush-config" data-brush-key="brush2" action="" onsubmit="return false">
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="modal modal-xl fade" id="modal-brush3-config"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content brush-config-container">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-brush"></i> <i class="bi bi-sliders"></i> <span class="modal-config-title">Brush3 config</span></h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body brush-preview border-bottom p-0" style="flex:0 0 auto;">
            <div class="brush-wrap text-center d-none justify-content-center align-items-center mx-auto" style="height: 200px;">
              <canvas id="brush3" data-brush-key="brush3" is="wc-brush" class="wc-brush" width="5" height="5"></canvas>
            </div>
            <div class="brush-wrap brush-preview-canvas-wrap text-center d-flex justify-content-center align-items-center mx-auto">
              <canvas class="brush-preview-canvas d-block mx-auto" is="wc-canvas" width="400" height="100"></canvas>
            </div>
          </div>
          <div class="modal-body brush-config">
            <form name="formBrush3Config" class="form-brush-config"  data-brush-key="brush3" action="" onsubmit="return false">
            </form>
          </div>
        </div>
      </div>
    </div>
    <div class="modal modal-xl fade" id="modal-eraser-config"  aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content brush-config-container">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-eraser"></i> <i class="bi bi-sliders"></i> <span class="modal-config-title">Eraser config</span></h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body brush-preview border-bottom p-0" style="flex:0 0 auto;">
            <div class="brush-wrap text-center d-none justify-content-center align-items-center mx-auto" style="height: 200px;">
              <canvas id="eraser" data-brush-key="eraser" is="wc-brush" class="wc-brush" width="5" height="5"></canvas>
            </div>
            <div class="brush-wrap brush-preview-canvas-wrap text-center d-flex justify-content-center align-items-center mx-auto">
              <canvas class="brush-preview-canvas d-block mx-auto" is="wc-canvas" width="400" height="100"></canvas>
            </div>
          </div>
          <div class="modal-body brush-config">
            <form name="formEraserConfig" class="form-brush-config"  data-brush-key="eraser" action="" onsubmit="return false">
            </form>
          </div>
        </div>
      </div>
    </div>
    <script>
      {
        // 브러시(지우개용 브러시 포함) 설정용 form 의 내용을 복사한다.
        WcHelper.cloneModalBrushConfigForm(document.formBrushConfig,document.formBrush2Config);
        WcHelper.cloneModalBrushConfigForm(document.formBrushConfig,document.formBrush3Config);
        WcHelper.cloneModalBrushConfigForm(document.formBrushConfig,document.formEraserConfig);
        window.addEventListener('load',(event)=>{
          setTimeout(()=>{

            //---- form -> brush
            const formToBrush = (f)=>{
              const brush = WcHelper.getBrushCanvas(f); 
              brush.setBrushConfig(Wc.HtmlUtil.formToObject(f)); 
              brush.saveBrushConfig(); 
              brush.flush();
            }
            document.querySelectorAll('.form-brush-config').forEach((f)=>{
              f.addEventListener('input',(event)=>{
                formToBrush(event.currentTarget);
              })
            })
            //---- brush -> preview , form
            const previewAndSyncForm = (brush,isEraser=false)=>{
              const container = brush.closest('.brush-config-container')
              WcHelper.syncModalBrushPreviewCanvas(brush,isEraser);
              const f = container.querySelector('.form-brush-config')
              Wc.HtmlUtil.objectToForm(brush.brushConfig,f)
              container.querySelectorAll('.ui-input-stepper input')?.forEach((input)=>{ UiInputStepper.syncDataValue(input); })
            }
            // 브러시가 draw 하면 미리보기를 다시 그린다.
            editor.brush.addEventListener('draw',(event)=>{ previewAndSyncForm(editor.brush) })
            editor.brush2.addEventListener('draw',(event)=>{ previewAndSyncForm(editor.brush2) })
            editor.brush3.addEventListener('draw',(event)=>{ previewAndSyncForm(editor.brush3) })
            editor.eraser.addEventListener('draw',(event)=>{ previewAndSyncForm(editor.eraser,true) })
            editor.brush.closest('.modal').addEventListener('shown.bs.modal', (event)=>{ setTimeout(()=>{ previewAndSyncForm(editor.brush) },100); })
            editor.brush2.closest('.modal').addEventListener('shown.bs.modal', (event)=>{ setTimeout(()=>{ previewAndSyncForm(editor.brush2) },100); })
            editor.brush3.closest('.modal').addEventListener('shown.bs.modal', (event)=>{ setTimeout(()=>{ previewAndSyncForm(editor.brush3) },100); })
            editor.eraser.closest('.modal').addEventListener('shown.bs.modal', (event)=>{ setTimeout(()=>{ previewAndSyncForm(editor.eraser,true) },100); })
  
            window.addEventListener('resize', (event)=>{
              previewAndSyncForm(editor.brush);
              previewAndSyncForm(editor.brush2);
              previewAndSyncForm(editor.brush3);
              previewAndSyncForm(editor.eraser,true);
            })
            
  
            previewAndSyncForm(editor.brush);
            previewAndSyncForm(editor.brush2);
            previewAndSyncForm(editor.brush3);
            previewAndSyncForm(editor.eraser,true);
          },600)
        })
      }
    </script>




    <div class="modal fade" id="modal-color-palette"  aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h2 class="modal-title fs-4"><i class="bi bi-palette"></i> Color palette</h2>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body brush-config">
            <div id="box-color-palette"></div>
          </div>
        </div>
      </div>
    </div>

  </div>

  <div class="etcs">

    <div id="brush-shapes" class="d-none">
      <img src="./asset/brush/shape/brush-01.png" id="brush-shape-brush-01"  data-shape-label="브러시-01">
      <img src="./asset/brush/shape/brush-02.png" id="brush-shape-brush-02"  data-shape-label="브러시-02">
      <img src="./asset/brush/shape/brush-03.png" id="brush-shape-brush-03"  data-shape-label="브러시-03">
      <img src="./asset/brush/shape/brush-04.png" id="brush-shape-brush-04"  data-shape-label="브러시-04">
    </div>
    <script>
      window.addEventListener('load',()=>{
        const shapes = [...document.querySelectorAll('#brush-shapes > *')].map((el)=>{ return el.id?el:null});
        
        document.querySelectorAll('.form-brush-config select.shape').forEach((el)=>{
          shapes.forEach(shape => {
            el.appendChild(new Option((shape.dataset.shapeLabel??'#'+shape.id),'#'+shape.id,false));
          });
        })
      })
    </script>


  </div>
</body>
</html>